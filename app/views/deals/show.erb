<%= render 'home/tabs', :locals => { :current_tab => 'my' } %>
    <div class="show-deal">
        <div class="form deal">
            <h1><%= @deal.title %></h1>
            
            <p style="background:#888; padding:1em 1.5em; line-height:1.5em; font-size:1.1em; "><em><%= @deal.content %></em></p>
            
            <p style="color:#333; font-weight:bold; "><%= @deal.published ? 'Published' : 'Not published' %></p>
            
            <p style="color:#333;">Updated <%= time_ago_in_words @deal.updated_at %> ago</p>
            
            <%= link_to 'Edit', edit_deal_path(@deal) if current_user && current_user.id == @deal.user_id %>
            
          <h2>Measures</h2>
            
            <div class="measure-sets">
              <%= render @deal.measure_sets %>
            </div>

            <% if @deal.user == current_user %>
                <h3>Add new measure set</h3>
                <div class="form measure-set">
                <% form_for [@deal, @measure_set] do |f| %>
                    <fieldset>
                        <%= f.label :title, "measure_set title: " %>
                        <%= f.text_field :title %>
                        
                        <%= f.check_box(:published) %>
                        <%= f.label :published, "published" %>
        
                        <% f.fields_for :measures do |mf| %>
                          <br />
                          <%= mf.text_field :title %>
                          <%= mf.text_field :value %>
                          <%= mf.check_box :published %>
                          <%= mf.label :published, "published" %>
                        <% end %>
                    </fieldset>
                    <fieldset class="submit-area">
                       <%= submit_tag %>
                    </fieldset>
                <% end %>
                </div>
            <% end %>

            <% unless @deal.comments.empty? %>
            
            <h2>Comments</h2>
            <%
            i = 0
            @deal.comments.each do |comment|
            %>
                <div class="comment-item <%= (i += 1).odd? ? 'first' : 'second' %>">
                        <% if comment.user %>
                    <div style="overflow:hidden; ">
                        <p class="email" style="float:left; font-weight:bold; "><a href="mailto:<%= comment.user.email %>"><%= comment.user.email %></a>:</p>
                        <p class="delete-comment" style="float:right;"><%= link_to "Delete comment", deal_comment_path(@deal, comment), :method => 'delete' if comment.user.id == current_user.id %></p>
                    </div>
                        <% end %>
                    <div class="comment-content">
                        <p>
                            <%= comment.content %>
                        </p>
                    </div>
                    <p class="date"><%= comment.created_at %></p>
                </div>
            <% end %>
            
            <% end %>
            
            <% if current_user %>
            
              <% form_for [@deal, @comment]  do |f| %>
              <fieldset>
                  <%= f.text_area :content %>
              </fieldset>
              <fieldset class="submit-area">
                  <%= f.submit 'Post comment' %>
              </fieldset>
              <% end %>
            
            <% end %>
        </div>
    </div>
</div>
